# Re-grounding Protocol

强制回读机制，防止上下文膨胀导致的目标偏移。

## 触发条件

以下任一条件满足时，**必须**执行回读：

1. **子任务完成时** — 每完成一个子任务后
2. **步骤累积时** — 每连续执行 3-5 步操作后
3. **不确定时** — 遇到模糊决策、多种可行方案时
4. **方向变化时** — 用户补充新信息或修改要求时

## 回读流程

```text
1. 读取 anchor.md
2. 与当前工作状态比对：
   - 当前行为是否仍在 Scope.Include 范围内？
   - 是否触及了 Scope.Exclude？
   - 是否满足 Constraints？
3. 输出对齐判定（写入 checkpoint.md）
```

### 对齐判定格式

```markdown
### Re-grounding [HH:MM]
- **对齐**: ✅ 对齐 / ⚠️ 轻微偏移 / ❌ 明显偏移
- **说明**: [一句话描述当前状态与 anchor 的关系]
- **动作**: 继续 / 调整 / 暂停请示
```

## 偏移处理

| 偏移程度 | 动作 |
|----------|------|
| ✅ 对齐 | 继续执行 |
| ⚠️ 轻微偏移 | 记录偏移，自行调整回正轨，继续 |
| ❌ 明显偏移 | 立即暂停 → 向用户报告偏移内容 → 等待指示 |

## 频率指南

| 任务规模 | 回读频率 |
|----------|----------|
| 短任务（< 5 步） | 开头 + 结尾各一次 |
| 中任务（5-10 步） | 开头 + 每 3 步 + 结尾 |
| 长任务（> 10 步） | 开头 + 每 3-5 步 + 子任务边界 + 结尾 |

## 与其他机制的关系

- **2-Action Rule**: 回读时同步更新 checkpoint.md
- **3-Strike Protocol**: 连续失败时触发额外回读
- **Phase 0**: anchor.md 是回读的唯一参照物
